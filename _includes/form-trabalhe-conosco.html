<form id="form-curriculo" class="needs-validation mt-4 bg-dark bg-gradient mouse-glow text-bg-dark p-4 p-lg-5 rounded-4" novalidate>
  <!-- Honeypot -->
  <div class="d-none">
    <input type="text" name="website" id="website" title="Website">
  </div>

  <div class="row g-3">
    <!-- Área de Atuação -->
    <div class="col-12">
      <label for="area" class="form-label visually-hidden">Área de Atuação / Interesse</label>
      <input type="text" class="form-control" id="area" name="area" placeholder="Área de Atuação / Interesse" required>
    </div>

    <!-- Dados Pessoais -->
    <div class="col-12">
      <h3 class="h5 mt-4 mb-2 lined text-light">Dados Pessoais</h3>
    </div>

    <div class="col-md-6">
      <label for="nome" class="form-label visually-hidden">Nome Completo</label>
      <input type="text" class="form-control" id="nome" name="nome" placeholder="Nome Completo" required>
    </div>

    <div class="col-md-6">
      <label for="nascimento" class="form-label visually-hidden">Data de Nascimento</label>
      <input type="text" class="form-control" id="nascimento" name="nascimento" placeholder="Data de Nascimento" required>
    </div>

    <div class="col-md-6">
      <label for="estadoCivil" class="form-label visually-hidden">Estado Civil</label>
      <select class="form-control" id="estadoCivil" name="estadoCivil" required>
        <option value="" selected disabled>Estado Civil</option>
        <option value="solteiro">Solteiro(a)</option>
        <option value="casado">Casado(a)</option>
        <option value="divorciado">Divorciado(a)</option>
        <option value="viuvo">Viúvo(a)</option>
      </select>
    </div>

    <div class="col-md-6">
      <label for="cpf" class="form-label visually-hidden">CPF</label>
      <input type="text" class="form-control cpf" id="cpf" name="cpf" placeholder="CPF" required>
    </div>

    <div class="col-md-6">
      <label for="telefone" class="form-label visually-hidden">Telefone</label>
      <input type="tel" class="form-control fone-br" id="telefone" name="telefone" placeholder="Telefone" required>
    </div>

    <div class="col-md-6">
      <label for="email" class="form-label visually-hidden">E-mail</label>
      <input type="email" class="form-control" id="email" name="email" placeholder="E-mail" required>
    </div>

    <div class="col-12">
      <label for="linkedin" class="form-label visually-hidden">LinkedIn</label>
      <input type="url" class="form-control" id="linkedin" name="linkedin" placeholder="Link do seu perfil no LinkedIn">
    </div>

    <!-- Endereço -->
    <div class="col-12">
      <h3 class="h5 mt-4 mb-2 lined text-light">Endereço</h3>
    </div>

    <div class="col-12">
      <label for="endereco" class="form-label visually-hidden">Endereço</label>
      <input type="text" class="form-control" id="endereco" name="endereco" placeholder="Endereço" required>
    </div>

    <div class="col-md-6">
      <label for="bairro" class="form-label visually-hidden">Bairro</label>
      <input type="text" class="form-control" id="bairro" name="bairro" placeholder="Bairro" required>
    </div>

    <div class="col-md-6">
      <label for="cidade" class="form-label visually-hidden">Cidade</label>
      <input type="text" class="form-control" id="cidade" name="cidade" placeholder="Cidade" required>
    </div>

    <div class="col-md-6">
      <label for="estado" class="form-label visually-hidden">Estado</label>
      <input type="text" class="form-control" id="estado" name="estado" placeholder="Estado" required>
    </div>

    <div class="col-md-6">
      <label for="cep" class="form-label visually-hidden">CEP</label>
      <input type="text" class="form-control cep" id="cep" name="cep" placeholder="CEP" required>
    </div>

    <!-- Escolaridade -->
    <div class="col-12">
      <h3 class="h5 mt-4 mb-2 lined text-light">Escolaridade</h3>
    </div>

    <div class="col-md-6">
      <label for="escolaridade" class="form-label visually-hidden">Escolaridade</label>
      <select class="form-control" id="escolaridade" name="escolaridade" required onchange="toggleFormacaoFields()">
        <option value="" selected disabled>Escolaridade</option>
        <option value="fundamental">Ensino Fundamental</option>
        <option value="medio">Ensino Médio</option>
        <option value="superior_incompleto">Ensino Superior Incompleto</option>
        <option value="superior_completo">Ensino Superior Completo</option>
        <option value="pos_graduacao">Pós-Graduação</option>
        <option value="mba">MBA</option>
        <option value="mestrado">Mestrado</option>
        <option value="doutorado">Doutorado</option>
      </select>
    </div>

    <div class="col-12 d-none" id="graduacao_container">
      <label for="graduacao" class="form-label visually-hidden">Curso / Graduação</label>
      <input type="text" class="form-control" id="graduacao" name="graduacao" placeholder="Curso / Graduação">
    </div>

    <div class="col-12 d-none" id="pos_graduacao1_container">
      <label for="pos_graduacao1" class="form-label visually-hidden">Pós-Graduação 1 (opcional)</label>
      <input type="text" class="form-control" id="pos_graduacao1" name="pos_graduacao1" placeholder="Pós-Graduação 1 (opcional)" onkeydown="togglePosGraduacao2()" onblur="togglePosGraduacao2()">
    </div>

    <div class="col-12 d-none" id="pos_graduacao2_container">
      <label for="pos_graduacao2" class="form-label visually-hidden">Pós-Graduação 2 (opcional)</label>
      <input type="text" class="form-control" id="pos_graduacao2" name="pos_graduacao2" placeholder="Pós-Graduação 2 (opcional)">
    </div>

    <div class="col-12 d-none" id="mba_container">
      <label for="mba" class="form-label visually-hidden">MBA</label>
      <input type="text" class="form-control" id="mba" name="mba" placeholder="MBA">
    </div>

    <div class="col-12 d-none" id="mestrado_container">
      <label for="mestrado" class="form-label visually-hidden">Mestrado</label>
      <input type="text" class="form-control" id="mestrado" name="mestrado" placeholder="Mestrado">
    </div>

    <div class="col-12 d-none" id="doutorado_container">
      <label for="doutorado" class="form-label visually-hidden">Doutorado</label>
      <input type="text" class="form-control" id="doutorado" name="doutorado" placeholder="Doutorado">
    </div>

    <!-- Experiência Profissional -->
    <div class="col-12">
      <h3 class="h5 mt-4 mb-2 lined text-light">Experiência Profissional</h3>
    </div>

    <div class="col-12">
      <label for="experiencia" class="form-label visually-hidden">Descreva sua experiência profissional</label>
      <textarea class="form-control" id="experiencia" name="experiencia" rows="4" placeholder="Descreva sua experiência profissional" required></textarea>
    </div>

    <!-- Cursos Complementares -->
    <div class="col-12">
      <h3 class="h5 mt-4 mb-2 lined text-light">Cursos Complementares</h3>
    </div>

    <div class="col-12">
      <label for="cursos" class="form-label visually-hidden">Descreva seus cursos complementares</label>
      <textarea class="form-control" id="cursos" name="cursos" rows="4" placeholder="Descreva seus cursos complementares"></textarea>
    </div>

    <!-- Aceite -->
    <div class="col-12">
      <div class="form-check text-balanced">
        <input class="form-check-input" type="checkbox" id="aceite" name="aceite" required>
        <label class="form-check-label small fst-italic cursor-pointer text-light" for="aceite">
          Aceito fornecer meus dados para que a Consiglog possa analisar meu perfil e entrar em contato caso haja oportunidades compatíveis com minhas habilidades.
        </label>
      </div>
    </div>

    <!-- Botão Enviar -->
    <div class="col-12 mt-4">
      <button type="submit" class="btn btn-primary btn-lg" id="form-curriculo-submit" disabled>
        <span class="material-symbols-rounded me-2">send</span>
        Cadastrar Currículo
      </button>
    </div>
  </div>
</form>

<!-- Alertas -->
<div class="form-alertas">
  <div id="form-curriculo-invalid" class="alert alert-warning alert-dismissible fade show mt-3 d-none" role="alert">
    {{ site.data.global.form_messages.invalid }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>

  <div id="form-curriculo-success" class="alert alert-success alert-dismissible fade show mt-3 d-none" role="alert">
    {{ site.data.global.form_messages.success.curriculo }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>

  <div id="form-curriculo-error" class="alert alert-danger alert-dismissible fade show mt-3 d-none" role="alert">
    {{ site.data.global.form_messages.error.curriculo }}
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
</div>

<script>
(function() {
  // Configurações do FormEasy
  const CONFIG = {
    url: "{{ site.data.global.formeasy.url }}"
  };

  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('form-curriculo');
    const submitButton = document.getElementById('form-curriculo-submit');
    const aceiteCheckbox = document.getElementById('aceite');
    const successAlert = document.getElementById('form-curriculo-success');
    const errorAlert = document.getElementById('form-curriculo-error');
    const invalidAlert = document.getElementById('form-curriculo-invalid');
    const nascimentoInput = document.getElementById('nascimento');

    // Máscara para o campo de data
    if (nascimentoInput) {
      nascimentoInput.addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        if (value.length > 8) value = value.slice(0, 8);
        
        if (value.length > 4) {
          value = value.replace(/(\d{2})(\d{2})(\d{4})/, '$1/$2/$3');
        } else if (value.length > 2) {
          value = value.replace(/(\d{2})(\d{2})/, '$1/$2');
        }
        
        e.target.value = value;
        
        // Verifica se a data é válida
        if (value.length === 10) {
          const [dia, mes, ano] = value.split('/').map(Number);
          const data = new Date(ano, mes - 1, dia);
          if (data instanceof Date && !isNaN(data) && 
              data.getDate() === dia && 
              data.getMonth() === mes - 1 && 
              data.getFullYear() === ano) {
            // Converte para campo date
            e.target.type = 'date';
            e.target.value = `${ano}-${mes.toString().padStart(2, '0')}-${dia.toString().padStart(2, '0')}`;
          } else {
            // Data inválida, volta para texto
            e.target.type = 'text';
            e.target.value = value;
          }
        }
      });

      // Ao perder o foco, se o valor não for uma data válida, volta para texto
      nascimentoInput.addEventListener('blur', function(e) {
        if (e.target.type === 'date' && !e.target.value) {
          e.target.type = 'text';
          e.target.value = '';
        }
      });
    }

    // Habilita/desabilita o botão baseado no checkbox
    aceiteCheckbox.addEventListener('change', () => {
      submitButton.disabled = !aceiteCheckbox.checked;
    });

    if (form) {
      form.addEventListener('submit', async (event) => {
        event.preventDefault();
        
        // Verifica honeypot
        if (form.querySelector('#website').value) {
          return;
        }

        if (!form.checkValidity()) {
          event.stopPropagation();
          form.classList.add('was-validated');
          invalidAlert.classList.remove('d-none');
          return;
        }

        submitButton.innerHTML = `
          <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
          Enviando...
        `;
        submitButton.disabled = true;

        try {
          const formData = {
            nome: form.querySelector('#nome')?.value || '',
            email: form.querySelector('#email')?.value || '',
            fone: form.querySelector('#telefone')?.value || '',
            assunto: 'curriculo',
            area: form.querySelector('#area')?.value || '',
            graduacao: form.querySelector('#graduacao')?.value || '',
            pos_graduacao1: form.querySelector('#pos_graduacao1')?.value || '',
            pos_graduacao2: form.querySelector('#pos_graduacao2')?.value || '',
            linkedin: form.querySelector('#linkedin')?.value || '',
            nascimento: form.querySelector('#nascimento')?.value || '',
            estadoCivil: form.querySelector('#estadoCivil option:checked')?.text || '',
            cpf: form.querySelector('#cpf')?.value || '',
            endereco: form.querySelector('#endereco')?.value || '',
            bairro: form.querySelector('#bairro')?.value || '',
            cidade: form.querySelector('#cidade')?.value || '',
            estado: form.querySelector('#estado')?.value || '',
            cep: form.querySelector('#cep')?.value || '',
            escolaridade: form.querySelector('#escolaridade option:checked')?.text || '',
            mba: form.querySelector('#mba')?.value || '',
            mestrado: form.querySelector('#mestrado')?.value || '',
            doutorado: form.querySelector('#doutorado')?.value || '',
            formacao: form.querySelector('#formacao')?.value || '',
            experiencia: form.querySelector('#experiencia')?.value || '',
            cursos: form.querySelector('#cursos')?.value || '',
            pagina: 'Trabalhe Conosco',
            origem: window.location.href
          };

          const response = await fetch(CONFIG.url, {
            method: "POST",
            headers: {
              "Content-Type": "text/plain;charset=utf-8"
            },
            body: JSON.stringify(formData)
          });

          const data = await response.json();
          console.log("Resposta do servidor:", data);

          form.reset();
          successAlert.classList.remove('d-none');
          invalidAlert.classList.add('d-none');
        } catch (error) {
          console.error('Erro:', error);
          errorAlert.classList.remove('d-none');
        } finally {
          submitButton.innerHTML = `
            <span class="material-symbols-rounded me-2">send</span>
            Cadastrar Currículo
          `;
          submitButton.disabled = !aceiteCheckbox.checked;
        }
      });
    }
  });
})();

function togglePosGraduacao2() {
  const posGrad1 = document.getElementById('pos_graduacao1');
  const posGrad2Container = document.getElementById('pos_graduacao2_container');
  const posGrad2 = document.getElementById('pos_graduacao2');
  
  if (posGrad1.value.trim() !== '') {
    posGrad2Container.classList.remove('d-none');
  } else {
    posGrad2Container.classList.add('d-none');
    posGrad2.value = ''; // Clear the value when hiding
  }
}

function toggleFormacaoFields() {
  const escolaridade = document.getElementById('escolaridade').value;
  const containers = {
    graduacao: document.getElementById('graduacao_container'),
    pos_graduacao1: document.getElementById('pos_graduacao1_container'),
    pos_graduacao2: document.getElementById('pos_graduacao2_container'),
    mba: document.getElementById('mba_container'),
    mestrado: document.getElementById('mestrado_container'),
    doutorado: document.getElementById('doutorado_container')
  };
  const fields = {
    graduacao: document.getElementById('graduacao'),
    pos_graduacao1: document.getElementById('pos_graduacao1'),
    pos_graduacao2: document.getElementById('pos_graduacao2'),
    mba: document.getElementById('mba'),
    mestrado: document.getElementById('mestrado'),
    doutorado: document.getElementById('doutorado')
  };

  // Primeiro, oculta e limpa todos os campos
  Object.keys(containers).forEach(key => {
    containers[key].classList.add('d-none');
    fields[key].value = '';
    if (fields[key].hasAttribute('required')) {
      fields[key].removeAttribute('required');
    }
  });

  // Depois, exibe os campos necessários baseado na escolaridade
  switch(escolaridade) {
    case 'superior_incompleto':
    case 'superior_completo':
      containers.graduacao.classList.remove('d-none');
      fields.graduacao.setAttribute('required', '');
      break;

    case 'mba':
      containers.graduacao.classList.remove('d-none');
      containers.mba.classList.remove('d-none');
      fields.graduacao.setAttribute('required', '');
      fields.mba.setAttribute('required', '');
      break;

    case 'pos_graduacao':
      containers.graduacao.classList.remove('d-none');
      containers.pos_graduacao1.classList.remove('d-none');
      fields.graduacao.setAttribute('required', '');
      break;

    case 'mestrado':
      containers.graduacao.classList.remove('d-none');
      containers.mestrado.classList.remove('d-none');
      fields.graduacao.setAttribute('required', '');
      fields.mestrado.setAttribute('required', '');
      break;

    case 'doutorado':
      containers.graduacao.classList.remove('d-none');
      containers.mestrado.classList.remove('d-none');
      containers.doutorado.classList.remove('d-none');
      fields.graduacao.setAttribute('required', '');
      fields.mestrado.setAttribute('required', '');
      fields.doutorado.setAttribute('required', '');
      break;
  }
}
</script>

<style>
#form-curriculo .glow-effect {
  --glow-size: 500px;
  opacity: 0.15 !important;
}
</style>